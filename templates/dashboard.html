<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Next-Gen IDS Dashboard</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
        }
        
        .container {
            max-width: 1400px;
            margin: 0 auto;
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 60px rgba(0,0,0,0.3);
            overflow: hidden;
        }
        
        header {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            padding: 30px;
            text-align: center;
        }
        
        header h1 {
            font-size: 2.5em;
            margin-bottom: 10px;
        }
        
        header p {
            font-size: 1.1em;
            opacity: 0.9;
        }
        
        .content {
            padding: 40px;
        }
        
        .section {
            margin-bottom: 40px;
            padding: 30px;
            background: #f8f9fa;
            border-radius: 10px;
            border-left: 5px solid #667eea;
        }
        
        .section h2 {
            color: #667eea;
            margin-bottom: 20px;
            font-size: 1.8em;
        }
        
        .upload-area {
            border: 3px dashed #667eea;
            border-radius: 10px;
            padding: 40px;
            text-align: center;
            background: white;
            transition: all 0.3s;
            cursor: pointer;
        }
        
        .upload-area:hover {
            border-color: #764ba2;
            background: #f0f0ff;
        }
        
        .upload-area input[type="file"] {
            display: none;
        }
        
        .btn {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border: none;
            padding: 12px 30px;
            border-radius: 25px;
            font-size: 1em;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            margin: 5px;
        }
        
        .btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px rgba(102, 126, 234, 0.4);
        }
        
        .btn:disabled {
            opacity: 0.5;
            cursor: not-allowed;
            transform: none;
        }
        
        .progress-bar {
            width: 100%;
            height: 30px;
            background: #e0e0e0;
            border-radius: 15px;
            overflow: hidden;
            margin: 20px 0;
            display: none;
        }
        
        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #667eea 0%, #764ba2 100%);
            width: 0%;
            transition: width 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-weight: bold;
        }
        
        .results-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 20px 0;
        }
        
        .metric-card {
            background: white;
            padding: 20px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.1);
            text-align: center;
        }
        
        .metric-card .value {
            font-size: 2.5em;
            font-weight: bold;
            color: #667eea;
            margin: 10px 0;
        }
        
        .metric-card .label {
            color: #666;
            font-size: 1.1em;
        }
        
        .explanation-box {
            background: #fff9e6;
            border-left: 5px solid #ffc107;
            padding: 20px;
            border-radius: 5px;
            margin: 20px 0;
        }
        
        .explanation-box h3 {
            color: #ff9800;
            margin-bottom: 10px;
        }
        
        .severity-critical { border-left-color: #f44336; }
        .severity-medium { border-left-color: #ff9800; }
        .severity-low { border-left-color: #4caf50; }
        
        .mitigation-steps {
            background: #e8f5e9;
            padding: 20px;
            border-radius: 5px;
            margin-top: 15px;
        }
        
        .mitigation-steps li {
            margin: 10px 0;
            padding-left: 10px;
        }
        
        #confusionMatrix {
            max-width: 100%;
            margin: 20px auto;
            display: block;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0,0,0,0.2);
        }
        
        .alert {
            padding: 15px;
            border-radius: 5px;
            margin: 15px 0;
            display: none;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border: 1px solid #c3e6cb;
        }
        
        .alert-error {
            background: #f8d7da;
            color: #721c24;
            border: 1px solid #f5c6cb;
        }
        
        .stats-table {
            width: 100%;
            margin: 20px 0;
            border-collapse: collapse;
        }
        
        .stats-table th, .stats-table td {
            padding: 12px;
            text-align: left;
            border-bottom: 1px solid #ddd;
        }
        
        .stats-table th {
            background: #667eea;
            color: white;
        }
        
        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(255,255,255,.3);
            border-radius: 50%;
            border-top-color: white;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>üõ°Ô∏è Next-Gen IDS Dashboard</h1>
            <p>Explainable Deep Learning & Blockchain-Secured Threat Detection</p>
        </header>
        
        <div class="content">
            <!-- Upload Section -->
            <div class="section">
                <h2>üìÇ Step 1: Upload Network Traffic Data</h2>
                <div class="upload-area" onclick="document.getElementById('fileInput').click()">
                    <p style="font-size: 3em;">üì§</p>
                    <p style="font-size: 1.2em; margin: 10px 0;">Click to upload CSV file</p>
                    <p style="color: #666;">Supported: CSV files with network traffic features</p>
                    <input type="file" id="fileInput" accept=".csv">
                </div>
                
                <div id="uploadAlert" class="alert"></div>
                
                <div id="fileStats" style="display: none; margin-top: 20px;">
                    <h3>üìä File Statistics</h3>
                    <table class="stats-table" id="statsTable">
                        <tr><th>Property</th><th>Value</th></tr>
                    </table>
                </div>
            </div>
            
            <!-- Training Section -->
            <div class="section">
                <h2>üß† Step 2: Train AI Model</h2>
                <p style="margin-bottom: 20px;">Configure and train the hybrid CNN+LSTM model on your data.</p>
                
                <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(200px, 1fr)); gap: 15px; margin-bottom: 20px;">
                    <div>
                        <label>Epochs:</label>
                        <input type="number" id="epochs" value="5" min="1" max="100" style="width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; border: 1px solid #ddd;">
                    </div>
                    <div>
                        <label>Batch Size:</label>
                        <input type="number" id="batchSize" value="32" min="8" max="128" step="8" style="width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; border: 1px solid #ddd;">
                    </div>
                    <div>
                        <label>Sequence Length:</label>
                        <input type="number" id="seqLen" value="64" min="16" max="256" step="16" style="width: 100%; padding: 8px; margin-top: 5px; border-radius: 5px; border: 1px solid #ddd;">
                    </div>
                </div>
                
                <div style="margin-bottom: 20px; padding: 15px; background: rgba(255,255,255,0.1); border-radius: 10px;">
                    <label style="display: flex; align-items: center; cursor: pointer; font-size: 1.1em;">
                        <input type="checkbox" id="useArnn" style="width: 20px; height: 20px; margin-right: 10px; cursor: pointer;">
                        <span>üöÄ Use A-RNN (Adaptive RNN) pre-stage</span>
                    </label>
                    <p style="margin: 10px 0 0 30px; color: #ddd; font-size: 0.9em;">
                        Enable the full NextGenIDS architecture: A-RNN ‚Üí S-LSTM ‚Üí CNN<br>
                        A-RNN adaptively extracts attack patterns before classification.
                    </p>
                </div>
                
                <button class="btn" id="trainBtn" onclick="trainModel()" disabled>
                    üöÄ Start Training
                </button>
                
                <div class="progress-bar" id="trainingProgress">
                    <div class="progress-fill" id="trainingProgressFill">0%</div>
                </div>
                
                <div id="trainingAlert" class="alert"></div>
            </div>
            
            <!-- Evaluation Section -->
            <div class="section">
                <h2>‚úÖ Step 3: Evaluate Model Performance</h2>
                <button class="btn" id="evalBtn" onclick="evaluateModel()" disabled>
                    üìä Run Evaluation
                </button>
                
                <div id="evalAlert" class="alert"></div>
                
                <div id="resultsContainer" style="display: none; margin-top: 30px;">
                    <h3>Performance Metrics</h3>
                    <div class="results-grid">
                        <div class="metric-card">
                            <div class="label">Accuracy</div>
                            <div class="value" id="accuracy">-</div>
                        </div>
                        <div class="metric-card">
                            <div class="label">Precision</div>
                            <div class="value" id="precision">-</div>
                        </div>
                        <div class="metric-card">
                            <div class="label">Recall</div>
                            <div class="value" id="recall">-</div>
                        </div>
                        <div class="metric-card">
                            <div class="label">F1 Score</div>
                            <div class="value" id="f1score">-</div>
                        </div>
                    </div>
                    
                    <h3 style="margin-top: 30px;">Confusion Matrix</h3>
                    <img id="confusionMatrix" alt="Confusion Matrix">
                </div>
            </div>
            
            <!-- AI Explanation Section -->
            <div class="section">
                <h2>ü§ñ AI-Powered Threat Analysis</h2>
                <p style="margin-bottom: 20px;">Get intelligent explanations and mitigation recommendations for detected threats.</p>
                
                <button class="btn" onclick="getExplanation()">
                    üîç Generate Threat Analysis
                </button>
                
                <div id="explanationContainer" style="display: none; margin-top: 20px;">
                    <div class="explanation-box" id="explanationBox">
                        <h3 id="threatTitle">Threat Detected</h3>
                        <p id="threatDescription"></p>
                        
                        <div style="margin-top: 15px;">
                            <strong>üéØ Detection Confidence:</strong> <span id="confidence"></span>
                        </div>
                        
                        <div style="margin-top: 15px;">
                            <strong>‚ö†Ô∏è Key Indicators:</strong>
                            <ul id="indicators"></ul>
                        </div>
                        
                        <div class="mitigation-steps">
                            <strong>üõ†Ô∏è Recommended Mitigation Steps:</strong>
                            <ol id="mitigationSteps"></ol>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
        let currentDataset = 'uploaded';
        
        // File upload handler
        document.getElementById('fileInput').addEventListener('change', async (e) => {
            const file = e.target.files[0];
            if (!file) return;
            
            const formData = new FormData();
            formData.append('file', file);
            formData.append('dataset_name', currentDataset);
            
            showAlert('uploadAlert', 'Uploading file...', 'success');
            
            try {
                const response = await fetch('/api/upload', {
                    method: 'POST',
                    body: formData
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('uploadAlert', `‚úì File uploaded successfully: ${file.name}`, 'success');
                    displayFileStats(data.stats);
                    document.getElementById('trainBtn').disabled = false;
                } else {
                    showAlert('uploadAlert', `Error: ${data.error}`, 'error');
                }
            } catch (error) {
                showAlert('uploadAlert', `Error: ${error.message}`, 'error');
            }
        });
        
        // Display file statistics
        function displayFileStats(stats) {
            const table = document.getElementById('statsTable');
            table.innerHTML = `
                <tr><th>Property</th><th>Value</th></tr>
                <tr><td>Filename</td><td>${stats.filename}</td></tr>
                <tr><td>Rows</td><td>${stats.rows.toLocaleString()}</td></tr>
                <tr><td>Columns</td><td>${stats.columns}</td></tr>
                <tr><td>Has Label Column</td><td>${stats.has_label ? '‚úì Yes' : '‚úó No (will create dummy labels)'}</td></tr>
            `;
            document.getElementById('fileStats').style.display = 'block';
        }
        
        // Train model
        async function trainModel() {
            const epochs = parseInt(document.getElementById('epochs').value);
            const batchSize = parseInt(document.getElementById('batchSize').value);
            const seqLen = parseInt(document.getElementById('seqLen').value);
            const useArnn = document.getElementById('useArnn').checked;
            
            document.getElementById('trainBtn').disabled = true;
            document.getElementById('trainingProgress').style.display = 'block';
            showAlert('trainingAlert', 'Training started...', 'success');
            
            try {
                const response = await fetch('/api/train', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        dataset_name: currentDataset,
                        epochs: epochs,
                        batch_size: batchSize,
                        seq_len: seqLen,
                        use_arnn: useArnn
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    document.getElementById('trainingProgressFill').style.width = '100%';
                    document.getElementById('trainingProgressFill').textContent = '100%';
                    showAlert('trainingAlert', `‚úì Training complete! Best F1: ${(data.best_f1 * 100).toFixed(2)}%`, 'success');
                    document.getElementById('evalBtn').disabled = false;
                } else {
                    showAlert('trainingAlert', `Error: ${data.error}`, 'error');
                }
            } catch (error) {
                showAlert('trainingAlert', `Error: ${error.message}`, 'error');
            } finally {
                document.getElementById('trainBtn').disabled = false;
            }
        }
        
        // Evaluate model
        async function evaluateModel() {
            const batchSize = parseInt(document.getElementById('batchSize').value);
            const seqLen = parseInt(document.getElementById('seqLen').value);
            
            document.getElementById('evalBtn').disabled = true;
            showAlert('evalAlert', 'Evaluating model...', 'success');
            
            try {
                const response = await fetch('/api/evaluate', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        dataset_name: currentDataset,
                        batch_size: batchSize,
                        seq_len: seqLen
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    showAlert('evalAlert', '‚úì Evaluation complete!', 'success');
                    displayResults(data);
                } else {
                    showAlert('evalAlert', `Error: ${data.error}`, 'error');
                }
            } catch (error) {
                showAlert('evalAlert', `Error: ${error.message}`, 'error');
            } finally {
                document.getElementById('evalBtn').disabled = false;
            }
        }
        
        // Display results
        function displayResults(data) {
            document.getElementById('accuracy').textContent = (data.metrics.accuracy * 100).toFixed(2) + '%';
            document.getElementById('precision').textContent = (data.metrics.precision * 100).toFixed(2) + '%';
            document.getElementById('recall').textContent = (data.metrics.recall * 100).toFixed(2) + '%';
            document.getElementById('f1score').textContent = (data.metrics.f1 * 100).toFixed(2) + '%';
            
            document.getElementById('confusionMatrix').src = 'data:image/png;base64,' + data.confusion_matrix;
            document.getElementById('resultsContainer').style.display = 'block';
        }
        
        // Get AI explanation
        async function getExplanation() {
            try {
                const response = await fetch('/api/explain', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        intrusion_type: 'DDoS',  // Example
                        confidence: 0.92
                    })
                });
                
                const data = await response.json();
                
                if (data.success) {
                    displayExplanation(data.explanation);
                }
            } catch (error) {
                alert('Error: ' + error.message);
            }
        }
        
        // Display explanation
        function displayExplanation(exp) {
            const box = document.getElementById('explanationBox');
            box.className = 'explanation-box severity-' + exp.severity.toLowerCase().replace(' ', '-');
            
            document.getElementById('threatTitle').textContent = `${exp.intrusion_type} - ${exp.severity} Severity`;
            document.getElementById('threatDescription').textContent = exp.description;
            document.getElementById('confidence').textContent = (exp.confidence * 100).toFixed(1) + '%';
            
            const indicators = document.getElementById('indicators');
            indicators.innerHTML = exp.indicators.map(i => `<li>${i}</li>`).join('');
            
            const steps = document.getElementById('mitigationSteps');
            steps.innerHTML = exp.mitigation_steps.map(s => `<li>${s}</li>`).join('');
            
            document.getElementById('explanationContainer').style.display = 'block';
        }
        
        // Utility: Show alert
        function showAlert(id, message, type) {
            const alert = document.getElementById(id);
            alert.className = `alert alert-${type}`;
            alert.textContent = message;
            alert.style.display = 'block';
        }
    </script>
</body>
</html>
